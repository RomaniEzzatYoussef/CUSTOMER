*  AUTHOR           : HASSAN MOHAMED
*  DATE             : 17 JUL 2019
*  CLIENT           : BDC
*  DESCRIPTION      : VALIDATE ON LEGAL ID FIELD BY PARAMETER TABLE
*-----------------------------------------------------------------------------
    SUBROUTINE  V.MBSC.MANDATORY.DOC
*-----------------------------------------------------------------------------

    $INSERT I_COMMON
    $INSERT I_EQUATE
	$INSERT I_F.CUSTOMER
	*$INSERT I_F.MBSC.CUS.LEG.ID
	$INSERT I_F.MBSC.LEGAL.DOC.PARAM
	$INSERT I_F.MBSC.CUST.PARAMETER
*-----------------------------------------------------------------------------
GOSUB INITIALISE
RETURN
*-----------------------------------------------------------------------------
INITIALISE:
*==========
CHECK.STATUS = ''
SECTOR.VAL = ''
NATION.VAL = ''
RESIDENCE.VAL = ''
STATUS.VAL = ''
INDUSTRY.VAL = ''

PARAM.ID.1 = ''
PARAM.ID.2 = ''

DOC.COUNT = ''
LEGAL.DOC = ''
LEGAL.ID.TYPE = ''

LEGAL.ID.NO = ''


PARAM.ID1=''

PARAM.ID2=''
PARAM.ID3=''
PARAM.ID4=''
PARAM.ID5=''
PARAM.ID6=''
PARAM.ID7=''
PARAM.ID8=''
PARAM.ID9=''
PARAM.IDX=''

CUST.STATUS = ''
		FN.CUSTOMER = 'F.CUSTOMER'
		F.CUSTOMER =''
		CALL OPF(FN.CUSTOMER,F.CUSTOMER)

		FN.MBSC.CUST.PARAMETER = 'F.MBSC.CUST.PARAMETER'
		F.MBSC.CUST.PARAMETER =''
		CALL OPF(FN.MBSC.CUST.PARAMETER,F.MBSC.CUST.PARAMETER)

		LEGALTYPE = ''
		LEGALTYPE = R.NEW(EB.CUS.LEGAL.DOC.NAME)
		CONVERT VM TO FM IN LEGALTYPE
		
		*================== Get Minor Flags ======================================
				CALL F.READ(FN.MBSC.CUST.PARAMETER,'SYSTEM',R.CUST.PARAM,F.MBSC.CUST.PARAMETER,MBSC.CUST.PARAMETER.ERR)
				
				CUST.STATUS = R.NEW(EB.CUS.CUSTOMER.STATUS)
				MINOR.ARR = R.CUST.PARAM<CUS.PA.MINOR>
				MINOR.EMP.ARR = R.CUST.PARAM<CUS.PA.MINOR.EMPLOYEE>
			  
				CONVERT VM TO FM IN MINOR.ARR
				CONVERT VM TO FM IN MINOR.EMP.ARR
				LOCATE CUST.STATUS IN MINOR.ARR SETTING MINOR.POS ELSE MINOR.POS = '0' 
				LOCATE CUST.STATUS IN MINOR.EMP.ARR SETTING MINOR.EMP.POS ELSE MINOR.EMP.POS = '0'









		



SECTOR.VAL = R.NEW(EB.CUS.SECTOR)
NATION.VAL = R.NEW(EB.CUS.NATIONALITY)
RESIDENCE.VAL = R.NEW(EB.CUS.RESIDENCE)
INDUSTRY.VAL = R.NEW(EB.CUS.INDUSTRY)
STATUS.VAL = R.NEW(EB.CUS.CUSTOMER.STATUS)




*=============== GENERATE PARAMETER ID ======================================================
PARAM.ID1 = SECTOR.VAL:'-':NATION.VAL:'-':RESIDENCE.VAL:'-':INDUSTRY.VAL:'-':STATUS.VAL

PARAM.ID2 = SECTOR.VAL:'-':NATION.VAL:'-':RESIDENCE.VAL:'-':INDUSTRY.VAL:'-':'0'
PARAM.ID3 = SECTOR.VAL:'-':NATION.VAL:'-':'0':'-':INDUSTRY.VAL:'-':'0'
PARAM.ID4 = SECTOR.VAL:'-':NATION.VAL:'-':RESIDENCE.VAL:'-':'0':'-':STATUS.VAL
PARAM.ID5 = SECTOR.VAL:'-':NATION.VAL:'-':'0':'-':'0':'-':STATUS.VAL
PARAM.ID6 = SECTOR.VAL:'-':NATION.VAL:'-':RESIDENCE.VAL:'-':'0':'-':'0'
PARAM.ID7 = SECTOR.VAL:'-':NATION.VAL:'-':'0':'-':'0':'-':'0'
PARAM.ID8 = SECTOR.VAL:'-':'0':'-':RESIDENCE.VAL:'-':'0':'-':'0'
PARAM.ID9 = SECTOR.VAL:'-':'0':'-':'0':'-':'0':'-':'0'




*================= USED FOR OTHER SECTOR (CORPORATE) ==================================
PARAM.IDX = '0':'-':'0':'-':'0':'-':'0':'-':'0'



*=======================================================================================
*============================END GENERATE ID ============================================





*===================== READ PARAMETER RECORDS====================================================
FN.MBSC.LEGAL.DOC.PARAM= 'F.MBSC.LEGAL.DOC.PARAM'
F.MBSC.LEGAL.DOC.PARAM =''
CALL OPF(FN.MBSC.LEGAL.DOC.PARAM,F.MBSC.LEGAL.DOC.PARAM)


CALL F.READ(FN.MBSC.LEGAL.DOC.PARAM, PARAM.ID1 ,  R.PARAM1 , F.MBSC.LEGAL.DOC.PARAM, ERR.PARAM)
CALL F.READ(FN.MBSC.LEGAL.DOC.PARAM, PARAM.ID2 ,  R.PARAM2 , F.MBSC.LEGAL.DOC.PARAM, ERR.PARAM)
CALL F.READ(FN.MBSC.LEGAL.DOC.PARAM, PARAM.ID3 ,  R.PARAM3 , F.MBSC.LEGAL.DOC.PARAM, ERR.PARAM)
CALL F.READ(FN.MBSC.LEGAL.DOC.PARAM, PARAM.ID4 ,  R.PARAM4 , F.MBSC.LEGAL.DOC.PARAM, ERR.PARAM)
CALL F.READ(FN.MBSC.LEGAL.DOC.PARAM, PARAM.ID5 ,  R.PARAM5 , F.MBSC.LEGAL.DOC.PARAM, ERR.PARAM)
CALL F.READ(FN.MBSC.LEGAL.DOC.PARAM, PARAM.ID6 ,  R.PARAM6 , F.MBSC.LEGAL.DOC.PARAM, ERR.PARAM)
CALL F.READ(FN.MBSC.LEGAL.DOC.PARAM, PARAM.ID7 ,  R.PARAM7 , F.MBSC.LEGAL.DOC.PARAM, ERR.PARAM)
CALL F.READ(FN.MBSC.LEGAL.DOC.PARAM, PARAM.ID8 ,  R.PARAM8 , F.MBSC.LEGAL.DOC.PARAM, ERR.PARAM)
CALL F.READ(FN.MBSC.LEGAL.DOC.PARAM, PARAM.ID9 ,  R.PARAM9 , F.MBSC.LEGAL.DOC.PARAM, ERR.PARAM)
CALL F.READ(FN.MBSC.LEGAL.DOC.PARAM, PARAM.IDX ,  R.PARAMX , F.MBSC.LEGAL.DOC.PARAM, ERR.PARAM)

*===================================== END READ PARAMETER RECORDS ==================================



BEGIN CASE

CASE  R.PARAM1
R.PARAM = R.PARAM1
GOSUB GETLISTOFDOCUMENT

CASE  R.PARAM2
R.PARAM = R.PARAM2
GOSUB GETLISTOFDOCUMENT

CASE  R.PARAM3
R.PARAM = R.PARAM3
GOSUB GETLISTOFDOCUMENT

CASE  R.PARAM4
R.PARAM = R.PARAM4
GOSUB GETLISTOFDOCUMENT

CASE  R.PARAM5
R.PARAM = R.PARAM5
GOSUB GETLISTOFDOCUMENT

CASE  R.PARAM6
R.PARAM = R.PARAM6
GOSUB GETLISTOFDOCUMENT

CASE  R.PARAM7
R.PARAM = R.PARAM7
GOSUB GETLISTOFDOCUMENT

CASE  R.PARAM8
R.PARAM = R.PARAM8
GOSUB GETLISTOFDOCUMENT

CASE  R.PARAM9
R.PARAM = R.PARAM9
GOSUB GETLISTOFDOCUMENT

CASE  1
IF R.PARAMX THEN 
R.PARAM = R.PARAMX
GOSUB GETLISTOFDOCUMENT
END


END CASE

IF CHECK.STATUS NE '1'	THEN
AF = EB.CUS.LEGAL.ID
*AV = I
ETEXT = 'EB-CUS.MBSC.LEGAL.14'
CALL STORE.END.ERROR
END	

				LOCATE 'NATIONAL.ID' IN LEGALTYPE SETTING DOC.POS ELSE DOC.POS = '0' 
				LOCATE 'BIRTH.CERTIFICATE' IN LEGALTYPE SETTING BIRTH.POS ELSE BIRTH.POS = '0' 
				IF R.NEW(EB.CUS.NATIONALITY) EQ 'EG' AND DOC.POS EQ '0' AND BIRTH.POS EQ '0' AND R.NEW(EB.CUS.SECTOR) EQ '401' THEN 
						AF = EB.CUS.LEGAL.ID
						ETEXT = 'EB-CUS.MBSC.LEGAL.15'
						CALL STORE.END.ERROR
				END

RETURN
*=================================================================================================
GETLISTOFDOCUMENT:
*=================


		
		
		
		DOC.COUNT = DCOUNT(R.PARAM<LEGAL.PARAM.DOCUMENT.NAME>,@VM)
		FOR I = 1 TO DOC.COUNT
		LEGAL.DOC    = R.PARAM<LEGAL.PARAM.DOCUMENT.NAME,I>
		
		IF LEGAL.DOC EQ 'BIRTH.CERTIFICATE' AND MINOR.POS EQ '0' AND MINOR.EMP.POS EQ '0'  THEN
			AF = EB.CUS.LEGAL.ID
			AV = I
			ETEXT = 'Birth Certificate Accepted only with minor customers'
			CALL STORE.END.ERROR
		END
		
		
		LOCATE LEGAL.DOC IN LEGALTYPE SETTING DOC.POS ELSE DOC.POS = '0' 
			IF DOC.POS NE '0' THEN 
				CHECK.STATUS = '1'
				RETURN 
			END
		NEXT I
		
		
		
		
		
		
		
		
		*GOSUB CHECKDOCUMENT
		*IF CHECK.STATUS EQ '1' THEN
		*RETURN
		*END
		
RETURN
CHECKDOCUMENT:
*=============

IF LEGAL.DOC NE '' THEN
LEGAL.COUNT = DCOUNT(R.NEW(EB.CUS.LEGAL.ID), @VM)
FOR X = 1 TO LEGAL.COUNT
			LEGAL.ID.TYPE    = R.NEW(EB.CUS.LEGAL.DOC.NAME)<1,X>
			LEGAL.ID.NO    = R.NEW(EB.CUS.LEGAL.ID)<1,X>
			IF LEGAL.ID.TYPE EQ LEGAL.DOC THEN
			CHECK.STATUS = '1'
			RETURN
			END			
NEXT X

	
END
RETURN

END
*************************************************************************************************


